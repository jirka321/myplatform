{% extends "base.html" %}

{% block title %}Přihlášení / Registrace{% endblock %}

{% block head_extra %}
<style>
    /* Celý CSS z původního login.html - zkopírováno 1:1 */
    :root {
        /* Colors from LP */
        --text: #0f1a24;
        --muted: #3f5e7a;
        --border: rgba(0, 0, 0, .08);
        --accent-a: #7EC8FF;
        --accent-b: #B8E1FF;
        --brand-blue: #3390CC;
        --brand-purple: #7A5FCC;
        --brand-pink: #C65C8C;
        --ink: #0a0a0a;
        --glass-bg: rgba(255, 255, 255, 0.55);
        --glass-border: rgba(10, 10, 10, 0.08);

        /* Layout variables */
        --header-h: 64px;
        --space-1: 8px;
        --space-2: 12px;
        --space-3: 16px;
        --space-4: 24px;
        --space-5: 32px;

        /* Z-index scale */
        --z-bg: 0;
        --z-content: 1;
        --z-header: 10;
    }

    /* Desktop overrides */
    @media (min-width: 1181px) {
        :root {
            --header-h: 84px;
        }
    }

    html,
    body {
        height: 100%
    }

    body {
        margin: 0;
        background: #FAF9F7;
        color: var(--ink);
        font-family: 'Poppins', ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        overflow-x: hidden;
        min-height: 100vh;
    }

    /* Form title row - odebrání form-logo logiky */
    .form-title {
        display: block;
        /* Zjednodušení */
    }

    .form-logo {
        display: none !important;
        /* Skrytí na všech velikostech */
    }

    .form-title .form-heading {
        margin: 0;
    }

    .mini-orb {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        position: relative;
        background: conic-gradient(from 0turn at 50% 50%, var(--brand-blue), var(--brand-purple), var(--brand-pink), var(--brand-blue)),
            radial-gradient(60% 60% at 45% 40%, rgba(255, 255, 255, .25), rgba(255, 255, 255, 0) 60%);
        box-shadow: 0 4px 10px rgba(0, 0, 0, .25), inset 0 0 0 1px rgba(255, 255, 255, .2);
        animation: sweep 7.5s linear infinite;
    }

    @media (min-width: 1181px) {
        .mini-orb {
            width: 38px;
            height: 38px;
        }
    }

    /* Main content */
    .layout {
        width: 100%;
        position: relative;
        z-index: var(--z-content);
    }

    .wrap {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: calc(var(--header-h) + 20px) 16px 40px;
        box-sizing: border-box;
    }

    /* Zajištění správné šířky - vyšší specifičnost */
    .layout .wrap .glass {
        width: min(560px, 100%) !important;
        max-width: 560px !important;
    }

    /* Oprava tlačítek - vyšší specifičnost pro přepsání base.html stylů */
    .layout main .controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-top: 20px;
    }

    .layout main .btn {
        border: none !important;
        padding: 12px 18px !important;
        border-radius: 50px !important;
        font-family: inherit !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        font-size: 16px !important;
        transition: all 0.2s ease !important;
        flex: 1 !important;
        /* Klíčové - tlačítka vedle sebe na desktopu */
    }

    .layout main .btn.primary {
        background: #0a0a0a !important;
        color: white !important;
        border: 1px solid #0a0a0a !important;
    }

    .layout main .btn.primary:hover {
        background: rgba(10, 10, 10, 0.8) !important;
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .layout main .btn.secondary {
        background: rgba(255, 255, 255, 0.4) !important;
        border: 1px solid var(--glass-border) !important;
        color: var(--ink) !important;
    }

    .layout main .btn.secondary:hover {
        background: rgba(255, 255, 255, 0.7) !important;
    }

    /* Mobile responsiveness - zachování původní logiky */
    @media (max-width: 640px) {
        .layout main .controls {
            flex-direction: column !important;
            gap: 10px !important;
        }

        .layout main .btn {
            width: 100% !important;
            flex: none !important;
            /* Reset flex na mobilu */
        }
    }

    .card {
        padding: 20px 22px;
        border: 1px solid var(--glass-border);
        border-radius: 18px;
        background: rgba(255, 255, 255, .65);
        box-shadow: 0 8px 22px rgba(15, 27, 36, .07);
        backdrop-filter: blur(16px) saturate(140%);
        -webkit-backdrop-filter: blur(16px) saturate(140%);
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 16px;
        padding-bottom: 18px;
        border-bottom: 1px solid rgba(0, 0, 0, .05);
        margin-bottom: 22px;
    }

    main {
        padding: 0;
    }

    h1 {
        margin: 0 0 8px;
        font-size: clamp(24px, 4vw, 28px);
        font-weight: 700;
    }

    .kicker {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 20px;
        line-height: 1.4;
    }

    .row {
        margin: 12px 0;
    }

    input {
        width: 100%;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid var(--glass-border);
        background: rgba(255, 255, 255, 0.8);
        color: var(--ink);
        outline: none;
        font-family: inherit;
        font-size: 16px;
        box-sizing: border-box;
        transition: border-color 0.2s ease, background 0.2s ease;
    }

    input:focus {
        border-color: var(--brand-blue);
        background: rgba(255, 255, 255, 0.95);
    }

    input::placeholder {
        color: var(--muted);
    }

    .controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-top: 20px;
    }

    .btn {
        border: none;
        padding: 12px 18px;
        border-radius: 50px;
        font-family: inherit;
        font-weight: 600;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s ease;
        flex: 1;
    }

    .btn.primary {
        background: var(--ink);
        color: white;
        border: 1px solid var(--ink);
    }

    .btn.primary:hover {
        background: rgba(10, 10, 10, 0.8);
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .btn.secondary {
        background: rgba(255, 255, 255, 0.4);
        border: 1px solid var(--glass-border);
        color: var(--ink);
    }

    .btn.secondary:hover {
        background: rgba(255, 255, 255, 0.7);
    }

    .msg {
        font-size: 13px;
        color: #b04a2a;
        min-height: 18px;
        margin-top: 12px;
    }

    /* Animations - same as LP */
    @keyframes sweep {
        0% {
            background-position: 0 0, 0 0;
        }

        100% {
            background-position: 360deg 0, 0 0;
        }
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: .95;
            filter: blur(90px);
        }

        50% {
            transform: scale(1.15);
            opacity: .85;
            filter: blur(120px);
        }

        100% {
            transform: scale(1);
            opacity: .95;
            filter: blur(90px);
        }
    }

    @keyframes drift {
        0% {
            transform: translate3d(-2vw, -2vh, 0) scale(1);
        }

        50% {
            transform: translate3d(2vw, 1vh, 0) scale(1.08);
        }

        100% {
            transform: translate3d(-2vw, -2vh, 0) scale(1);
        }
    }

    /* Mobile responsiveness */
    @media (max-width: 640px) {
        .wrap {
            padding: calc(var(--header-h) + 20px) 16px 40px;
            align-items: flex-start;
            min-height: calc(100vh - var(--header-h));
        }

        .controls {
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            width: 100%;
        }

        .card {
            padding: 16px 18px;
        }

        .card-header {
            padding-bottom: 16px;
            margin-bottom: 18px;
        }

        /* Performance optimizations for mobile */
        .bg::before,
        .bg::after {
            opacity: .55;
            filter: blur(18px);
        }

        .blob {
            opacity: .10;
            filter: blur(40px);
            animation: none;
        }
    }

    /* Tablet responsiveness */
    @media (min-width: 641px) and (max-width: 1180px) {
        .wrap {
            padding: calc(var(--header-h) + 30px) 32px 40px;
        }

        .glass {
            max-width: 720px;
        }

        /* Lighten background effects on tablets */
        .bg::before {
            filter: blur(70px);
            opacity: .7;
        }

        .blob {
            filter: blur(70px);
            opacity: .12;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Celý obsah z body původního login.html - jen bez site-header, s inline styly -->
<div class="layout">
    <div class="wrap">
        <div class="glass" style="width: min(560px, 100%) !important; max-width: 560px !important;">
            <div class="card">
                <div class="card-header">
                    <!-- Prázdný header pro konzistentní spacing -->
                </div>
                <main>
                    <h1>Přihlášení / Registrace</h1>
                    <div class="row"><input id="email" type="email" placeholder="Email" required></div>
                    <div class="row"><input id="password" type="password" placeholder="Heslo" required></div>
                    <div class="controls"
                        style="display: flex !important; align-items: center !important; justify-content: space-between !important; gap: 12px !important; margin-top: 20px !important;">
                        <button class="btn secondary" id="btn-login"
                            style="border: none !important; padding: 12px 18px !important; border-radius: 50px !important; font-family: inherit !important; font-weight: 600 !important; cursor: pointer !important; font-size: 16px !important; transition: all 0.2s ease !important; flex: 1 !important; background: rgba(255, 255, 255, 0.4) !important; border: 1px solid rgba(10, 10, 10, 0.08) !important; color: #0a0a0a !important; min-height: auto !important; min-width: auto !important;">Přihlásit</button>
                        <button class="btn primary" id="btn-register"
                            style="border: none !important; padding: 12px 18px !important; border-radius: 50px !important; font-family: inherit !important; font-weight: 600 !important; cursor: pointer !important; font-size: 16px !important; transition: all 0.2s ease !important; flex: 1 !important; background: #0a0a0a !important; color: white !important; border: 1px solid #0a0a0a !important; min-height: auto !important; min-width: auto !important;">Start
                            for free</button>
                    </div>
                    <p class="signup-hint" aria-live="polite">
                        Don’t have an account yet? <a href="#" id="signupLink" class="link">Start for free</a>
                    </p>
            </div>
            <div class="msg" id="msg"></div>
            <div class="kicker" style="margin-top: 16px;">
            </div>
            </main>
        </div>
    </div>
</div>
</div>

<!-- Mobile styles přes media query v head -->
<style>
    @media (max-width: 640px) {
        .controls {
            flex-direction: column !important;
            gap: 10px !important;
        }

        .btn {
            width: 100% !important;
            flex: none !important;
        }
    }

    .signup-hint {
        text-align: center;
        margin-top: 12px;
        font-size: 14px;
        color: var(--muted);
    }

    .signup-hint .link {
        color: var(--ink);
        text-decoration: underline;
        cursor: pointer;
    }

    .signup-hint .link:hover {
        opacity: .85;
    }
</style>
{% endblock %}

{% block scripts %}
<!-- CSS přesunutý na konec pro vyšší prioritu -->
<style>
    /* Vynucení správné šířky */
    .layout .wrap .glass {
        width: min(560px, 100%) !important;
        max-width: 560px !important;
    }

    /* Vynucení správného chování tlačítek */
    .layout main .controls {
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        gap: 12px !important;
        margin-top: 20px !important;
    }

    .layout main .btn {
        border: none !important;
        padding: 12px 18px !important;
        border-radius: 50px !important;
        font-family: inherit !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        font-size: 16px !important;
        transition: all 0.2s ease !important;
        flex: 1 !important;
        min-height: auto !important;
        min-width: auto !important;
    }

    .layout main .btn.primary {
        background: #0a0a0a !important;
        color: white !important;
        border: 1px solid #0a0a0a !important;
    }

    .layout main .btn.primary:hover {
        background: rgba(10, 10, 10, 0.8) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2) !important;
    }

    .layout main .btn.secondary {
        background: rgba(255, 255, 255, 0.4) !important;
        border: 1px solid rgba(10, 10, 10, 0.08) !important;
        color: #0a0a0a !important;
    }

    .layout main .btn.secondary:hover {
        background: rgba(255, 255, 255, 0.7) !important;
    }

    /* Mobile responsiveness */
    @media (max-width: 640px) {
        .layout main .controls {
            flex-direction: column !important;
            gap: 10px !important;
        }

        .layout main .btn {
            width: 100% !important;
            flex: none !important;
        }
    }
</style>

<script>
    // JavaScript pro vynucení správných stylů
    document.addEventListener('DOMContentLoaded', function () {
        // Oprava šířky
        const glass = document.querySelector('.glass');
        if (glass) {
            glass.style.width = 'min(560px, 100%)';
            glass.style.maxWidth = '560px';
        }

        // Oprava tlačítek
        const controls = document.querySelector('.controls');
        const buttons = document.querySelectorAll('.btn');

        if (controls) {
            controls.style.display = 'flex';
            controls.style.alignItems = 'center';
            controls.style.justifyContent = 'space-between';
            controls.style.gap = '12px';
            controls.style.marginTop = '20px';
        }

        buttons.forEach(btn => {
            btn.style.border = 'none';
            btn.style.padding = '12px 18px';
            btn.style.borderRadius = '50px';
            btn.style.fontFamily = 'inherit';
            btn.style.fontWeight = '600';
            btn.style.cursor = 'pointer';
            btn.style.fontSize = '16px';
            btn.style.transition = 'all 0.2s ease';
            btn.style.flex = '1';
            btn.style.minHeight = 'auto';
            btn.style.minWidth = 'auto';

            if (btn.classList.contains('primary')) {
                btn.style.background = '#0a0a0a';
                btn.style.color = 'white';
                btn.style.border = '1px solid #0a0a0a';
            } else if (btn.classList.contains('secondary')) {
                btn.style.background = 'rgba(255, 255, 255, 0.4)';
                btn.style.border = '1px solid rgba(10, 10, 10, 0.08)';
                btn.style.color = '#0a0a0a';
            }
        });

        // Mobile responsiveness
        function handleResize() {
            if (window.innerWidth <= 640) {
                if (controls) {
                    controls.style.flexDirection = 'column';
                    controls.style.gap = '10px';
                }
                buttons.forEach(btn => {
                    btn.style.width = '100%';
                    btn.style.flex = 'none';
                });
            } else {
                if (controls) {
                    controls.style.flexDirection = 'row';
                    controls.style.gap = '12px';
                }
                buttons.forEach(btn => {
                    btn.style.width = 'auto';
                    btn.style.flex = '1';
                });
            }
        }

        handleResize();
        window.addEventListener('resize', handleResize);
    });

    // Původní JavaScript z login.html
    const $ = s => document.querySelector(s);

    async function call(url, body) {
        try {
            const r = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });
            const j = await r.json();

            if (j.message) {
                location.href = "/priorities/";
            } else {
                $("#msg").textContent = j.error || "Chyba";
            }
        } catch (e) {
            $("#msg").textContent = "Server nedostupný";
        }
    }

    $("#btn-login").onclick = () => {
        const email = $("#email").value.trim();
        const password = $("#password").value.trim();

        if (!email || !password) {
            $("#msg").textContent = "Vyplň email i heslo";
            return;
        }

        call("/login", { email, password });
    };

    $("#btn-register").onclick = () => {
        const email = $("#email").value.trim();
        const password = $("#password").value.trim();

        if (!email || !password) {
            $("#msg").textContent = "Vyplň email i heslo";
            return;
        }

        call("/register", { email, password });
    };

    // Link in the hint triggers register
    const signupLink = document.getElementById('signupLink');
    if (signupLink) {
        signupLink.addEventListener('click', (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-register');
            if (btn) btn.click();
        });
    }

    // Enter key support
    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            $("#btn-register").click();
        }
    });
</script>
{% endblock %}